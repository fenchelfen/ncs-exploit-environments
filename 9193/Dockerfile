FROM ubuntu:18.04


RUN apt update && apt -y install vim.tiny net-tools psmisc

RUN mkdir /app
WORKDIR /app


RUN apt install -y build-essential libreadline-dev 


ADD ./postgresql-9.3.0 ./postgresql-9.3.0


RUN cd postgresql-9.3.0 && ./configure --without-zlib && make && make install

RUN useradd postgres && \
    mkdir /usr/local/pgsql/data && \
    chown postgres /usr/local/pgsql/data

ADD setup_postgres.sh .
RUN bash setup_postgres.sh

EXPOSE 5432

RUN echo "listen_addresses = '*'" >>  /usr/local/pgsql/data/postgresql.conf

RUN sed "/^# IPv4 local connections:/a host    all             all             all                     trust" /usr/local/pgsql/data/pg_hba.conf -i

USER postgres
ENTRYPOINT /usr/local/pgsql/bin/postgres -D /usr/local/pgsql/data

